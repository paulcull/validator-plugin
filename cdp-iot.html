<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Report: CDP vs. IoT Architecture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Slate, Cyan) -->
    <!-- Application Structure Plan: The SPA is designed as an interactive, single-page dashboard with sticky top navigation. This non-linear structure enhances usability by allowing users to explore thematic sections: Core Architectures, Operational Patterns, Advanced Topologies, Management & Governance, and a new 'Recommended Architecture' section. The recommended architecture section visualizes a concrete deployment model (Global Control Plane), making the report's findings actionable. Interactive elements like charts, expandable cards, and a detailed HTML/CSS architecture diagram present complex information in a digestible, engaging manner, which is superior to a static document for exploring these interconnected concepts. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Proposed Architecture -> Goal: Inform & Organize -> Viz: HTML/CSS Diagram with expandable components -> Interaction: Click to expand/collapse component details. -> Justification: A visual diagram is essential for explaining a complex architecture like a global control plane. Expandable sections provide on-demand detail without cluttering the diagram, making it interactive and informative without external images or SVG. -> Library: Tailwind CSS, Vanilla JS.
        - Report Info: Technology Stack Comparison -> Goal: Compare -> Viz: Interactive Radar Chart -> Interaction: Toggle buttons to switch between CDP, IoT, and overlay views. -> Justification: A radar chart effectively shows relative strengths across multiple domains. Toggling makes comparison direct. -> Library: Chart.js.
        - Report Info: Protocol Characteristics -> Goal: Compare -> Viz: Grouped Bar Chart -> Interaction: Hover tooltips. -> Justification: A bar chart provides a clear quantitative comparison of protocol performance metrics. -> Library: Chart.js.
        - Report Info: Key Concepts (Resilience, etc.) -> Goal: Inform -> Viz: Interactive Cards -> Interaction: Click to expand detailed text. -> Justification: Presents high-level concepts cleanly and encourages exploration via drill-down. -> Library: Vanilla JS.
        -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .nav-link.active {
            color: #0891b2; /* cyan-600 */
            border-bottom-color: #0891b2;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .expandable-card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        .expandable-card.open .expandable-card-content {
            max-height: 1000px; /* Large enough to fit content */
            transition: max-height 0.7s ease-in;
        }
        .expandable-card.open .chevron {
            transform: rotate(180deg);
        }
        .chevron {
            transition: transform 0.3s ease-in-out;
        }
        /* arch-diagram-component specific styling retained for overall hover effects on main blocks */
        .arch-diagram-component {
            position: relative;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .arch-diagram-component:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Removed .arch-tooltip as it's replaced by expandable sections */
        .connector {
            position: absolute;
            background-color: #cbd5e1; /* slate-300 */
            z-index: -1;
        }
        .connector.vertical { width: 2px; }
        .connector.horizontal { height: 2px; }
        .arrow-down::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid #cbd5e1;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-slate-800">CDP <span class="text-cyan-600">&</span> IoT</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#overview" class="nav-link px-3 py-2 text-sm font-medium text-slate-600 hover:text-cyan-600 border-b-2 border-transparent">Overview</a>
                        <a href="#architectures" class="nav-link px-3 py-2 text-sm font-medium text-slate-600 hover:text-cyan-600 border-b-2 border-transparent">Core Architectures</a>
                        <a href="#operations" class="nav-link px-3 py-2 text-sm font-medium text-slate-600 hover:text-cyan-600 border-b-2 border-transparent">Operational Patterns</a>
                        <a href="#topologies" class="nav-link px-3 py-2 text-sm font-medium text-slate-600 hover:text-cyan-600 border-b-2 border-transparent">Advanced Topologies</a>
                        <a href="#management" class="nav-link px-3 py-2 text-sm font-medium text-slate-600 hover:text-cyan-600 border-b-2 border-transparent">Management</a>
                        <a href="#recommendation" class="nav-link px-3 py-2 text-sm font-medium text-slate-600 hover:text-cyan-600 border-b-2 border-transparent">Recommendation</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <select id="mobile-nav" class="bg-slate-100 border border-slate-300 rounded-md p-2 text-sm w-full">
                        <option value="#overview">Overview</option>
                        <option value="#architectures">Core Architectures</option>
                        <option value="#operations">Operational Patterns</option>
                        <option value="#topologies">Advanced Topologies</option>
                        <option value="#management">Management & Gov.</option>
                        <option value="#recommendation">Recommendation</option>
                    </select>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        
        <!-- Section: Overview -->
        <section id="overview" class="mb-24 space-y-8 scroll-mt-20">
            <div class="text-center">
                <h2 class="text-base font-semibold text-cyan-600 tracking-wide uppercase">Architectural Symbiosis</h2>
                <p class="mt-2 text-3xl font-extrabold text-slate-900 tracking-tight sm:text-4xl">Transferable Patterns from IoT to Customer Decisioning</p>
                <p class="mt-4 max-w-2xl mx-auto text-xl text-slate-500">
                    An interactive exploration of the fundamental architectural similarities between Customer Decisioning Platforms (CDPs) and IoT implementations.
                </p>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold text-slate-900 mb-4">Executive Summary & Hypothesis</h3>
                <p class="text-slate-600 leading-relaxed mb-4">
                    This analysis validates the hypothesis that CDPs and IoT systems share a significant architectural overlap in their event-driven, real-time decision-making capabilities. Both domains are driven by the imperative to process high-velocity data streams for immediate, context-aware actions. Key transferable patterns identified can significantly enhance CDP resilience, performance, and configuration agility in retail and finance. 
                </p>
                <p class="text-slate-600 leading-relaxed">
                   Based on these findings, this report proposes a recommended technical architecture for a global CDP, structured around a **Global Control Plane with orchestrated Operational Nodes**. This model, inspired by IoT's distributed management patterns, provides a blueprint for building a scalable, resilient, and governable decisioning platform that meets the complex demands of a modern global enterprise.
                </p>
            </div>
        </section>

        <!-- Section: Core Architectures -->
        <section id="architectures" class="mb-24 space-y-12 scroll-mt-20">
            <div class="text-center">
                <h2 class="text-base font-semibold text-cyan-600 tracking-wide uppercase">Foundations</h2>
                <p class="mt-2 text-3xl font-extrabold text-slate-900 tracking-tight sm:text-4xl">Core Architectures & Technology Stacks</p>
                 <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-500">
                    This section explores the foundational building blocks of both CDP and IoT systems. At their heart, both are event-driven, relying on similar patterns and technologies to ingest, process, and act on vast streams of data in real time. We'll compare their technology stacks and visualize key architectural patterns that enable their capabilities.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h3 class="text-lg font-bold text-slate-900 mb-2 text-center">Interactive Tech Stack Comparison</h3>
                    <p class="text-center text-slate-500 mb-4 text-sm">Toggle between views to see how CDP and IoT technology choices overlap and differ across key architectural domains.</p>
                    <div class="chart-container">
                        <canvas id="techStackRadarChart"></canvas>
                    </div>
                    <div class="mt-4 flex justify-center space-x-2">
                        <button id="cdpBtn" class="px-4 py-2 text-sm font-medium rounded-md bg-cyan-500 text-white">CDP View</button>
                        <button id="iotBtn" class="px-4 py-2 text-sm font-medium rounded-md bg-slate-200 text-slate-700">IoT View</button>
                        <button id="bothBtn" class="px-4 py-2 text-sm font-medium rounded-md bg-slate-200 text-slate-700">Overlay View</button>
                    </div>
                </div>

                <div class="space-y-8">
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Pattern: Event-Driven Architecture (EDA)</h3>
                        <p class="text-slate-600 text-sm mb-4">EDA is the backbone for both systems. Below is a simplified diagram illustrating the two main topologies: Broker (decoupled) and Mediator (orchestrated).</p>
                        <div class="space-y-4">
                            <!-- Broker Topology Diagram -->
                            <div>
                                <h4 class="font-semibold text-slate-700">Broker Topology</h4>
                                <div class="mt-2 flex items-center justify-around p-4 bg-slate-50 rounded-lg border border-slate-200">
                                    <div class="text-center"><div class="p-2 bg-blue-100 text-blue-800 rounded-full text-xs">Producer</div></div>
                                    <div class="flex-grow h-px bg-slate-300 mx-2"></div>
                                    <div class="text-center"><div class="p-2 bg-slate-200 text-slate-800 rounded-lg text-xs">Event Bus</div></div>
                                    <div class="flex-grow h-px bg-slate-300 mx-2"></div>
                                    <div class="flex flex-col space-y-2">
                                         <div class="p-2 bg-green-100 text-green-800 rounded-full text-xs">Consumer A</div>
                                         <div class="p-2 bg-green-100 text-green-800 rounded-full text-xs">Consumer B</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Mediator Topology Diagram -->
                            <div>
                                <h4 class="font-semibold text-slate-700">Mediator Topology</h4>
                                 <div class="mt-2 flex items-center justify-around p-4 bg-slate-50 rounded-lg border border-slate-200">
                                    <div class="text-center"><div class="p-2 bg-blue-100 text-blue-800 rounded-full text-xs">Producer</div></div>
                                    <div class="flex-grow h-px bg-slate-300 mx-2"></div>
                                    <div class="text-center"><div class="p-2 bg-purple-100 text-purple-800 rounded-lg text-xs">Mediator</div></div>
                                    <div class="flex-grow h-px bg-slate-300 mx-2"></div>
                                    <div class="flex flex-col space-y-2">
                                         <div class="p-2 bg-green-100 text-green-800 rounded-full text-xs">Consumer A</div>
                                         <div class="p-2 bg-green-100 text-green-800 rounded-full text-xs">Consumer B</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Pattern: CQRS & Event Sourcing</h3>
                        <p class="text-slate-600 text-sm mb-4">Command Query Responsibility Segregation (CQRS) separates read and write operations, a powerful pattern for performance and scalability, often paired with Event Sourcing.</p>
                        <div class="mt-2 p-4 bg-slate-50 rounded-lg border border-slate-200">
                            <div class="flex flex-col md:flex-row gap-4">
                                <div class="flex-1 text-center p-3 border-r-0 md:border-r-2 border-dashed border-red-300">
                                    <h4 class="font-semibold text-red-600">Write Model (Commands)</h4>
                                    <p class="text-xs text-slate-500 mt-1">User Action ‚ûî Command ‚ûî Generate Event</p>
                                    <div class="mt-2 text-3xl">‚úèÔ∏è</div>
                                    <p class="text-xs mt-1 font-mono bg-red-100 p-1 rounded">Event Store (Log)</p>
                                </div>
                                <div class="flex-1 text-center p-3">
                                    <h4 class="font-semibold text-blue-600">Read Model (Queries)</h4>
                                    <p class="text-xs text-slate-500 mt-1">Events ‚ûî Projector ‚ûî Update View</p>
                                    <div class="mt-2 text-3xl">üîç</div>
                                    <p class="text-xs mt-1 font-mono bg-blue-100 p-1 rounded">Materialized Views</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-lg">
                 <h3 class="text-lg font-bold text-slate-900 mb-2 text-center">Protocol Suitability Comparison</h3>
                 <p class="text-center text-slate-500 mb-4 text-sm">Both domains use various communication protocols. This chart compares common protocols on key characteristics like latency and overhead, illustrating the trade-offs involved. Lower bars are better for Latency/Overhead, higher is better for Real-time Suitability.</p>
                 <div class="chart-container h-96 max-h-[500px]">
                    <canvas id="protocolBarChart"></canvas>
                </div>
            </div>

        </section>

        <!-- Section: Operational Patterns -->
        <section id="operations" class="mb-24 space-y-12 scroll-mt-20">
            <div class="text-center">
                <h2 class="text-base font-semibold text-cyan-600 tracking-wide uppercase">Performance & Resilience</h2>
                <p class="mt-2 text-3xl font-extrabold text-slate-900 tracking-tight sm:text-4xl">Operational Patterns</p>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-500">
                    How do these systems perform under pressure and recover from failure? This section dives into the shared patterns for scalability, performance optimization, and reliability. Explore the key concepts that ensure these platforms are fast, robust, and dependable.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div id="operational-cards-container"></div>
            </div>
        </section>

        <!-- Section: Advanced Topologies -->
        <section id="topologies" class="mb-24 space-y-12 scroll-mt-20">
             <div class="text-center">
                <h2 class="text-base font-semibold text-cyan-600 tracking-wide uppercase">Distributed Intelligence</h2>
                <p class="mt-2 text-3xl font-extrabold text-slate-900 tracking-tight sm:text-4xl">Advanced Topologies: Edge & Federation</p>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-500">
                    Modern architectures are increasingly distributed. Here, we examine the highly transferable patterns of Edge Computing and Federation, which allow for localized decision-making, enhanced privacy, and global scalability while respecting data sovereignty.
                </p>
            </div>
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div id="topologies-cards-container"></div>
            </div>
        </section>

        <!-- Section: Management & Governance -->
        <section id="management" class="mb-24 space-y-12 scroll-mt-20">
            <div class="text-center">
                <h2 class="text-base font-semibold text-cyan-600 tracking-wide uppercase">Control and Compliance</h2>
                <p class="mt-2 text-3xl font-extrabold text-slate-900 tracking-tight sm:text-4xl">Management & Governance</p>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-500">
                    Agility and control must go hand-in-hand, especially in regulated industries like finance. This final section covers the patterns for dynamic configuration, rule management, versioning, and the critical importance of compliance and data governance.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                 <div class="space-y-8">
                     <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Pattern: Blue/Green Deployment</h3>
                        <p class="text-slate-600 text-sm mb-4">A strategy for releasing software updates with zero downtime and instant rollback capabilities. This is crucial for safely deploying new decisioning rules.</p>
                        <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                           <div class="relative flex flex-col items-center h-40">
                                <div class="mb-2 text-center text-sm font-semibold">Router / Load Balancer</div>
                                <div class="w-8 h-8 bg-slate-800 rounded-full flex items-center justify-center text-white text-xl">‚ûî</div>
                                <div class="absolute top-16 flex w-full justify-around">
                                    <div class="text-center">
                                        <div class="w-24 h-24 bg-blue-500 rounded-lg flex flex-col items-center justify-center text-white">
                                            <span class="font-bold">Blue</span>
                                            <span>v1.0 (Live)</span>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                         <div class="w-24 h-24 bg-green-500 rounded-lg flex flex-col items-center justify-center text-white">
                                            <span class="font-bold">Green</span>
                                            <span>v1.1 (New)</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="absolute top-20 left-1/4 w-0.5 h-16 border-l-2 border-dashed border-cyan-500"></div>
                                <div class="absolute top-20 right-1/4 w-0.5 h-16 border-l-2 border-dashed border-slate-300"></div>

                           </div>
                           <p class="text-xs text-center mt-4 text-slate-500">Live traffic is directed to Blue. Green is tested. Once validated, the router switches traffic to Green.</p>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-6">
                    <div id="management-cards-container"></div>
                </div>
            </div>
        </section>
        
        <!-- Section: Recommended Architecture -->
        <section id="recommendation" class="mb-16 space-y-12 scroll-mt-20">
            <div class="text-center">
                <h2 class="text-base font-semibold text-cyan-600 tracking-wide uppercase">Proposed Blueprint</h2>
                <p class="mt-2 text-3xl font-extrabold text-slate-900 tracking-tight sm:text-4xl">Recommended Technical Architecture</p>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-500">
                    Synthesizing the transferable patterns from IoT, this section proposes a resilient, scalable, and manageable architecture for a global Customer Decisioning Platform. The model is built around a **Global Control Plane** for central governance and **Orchestrated Operational Nodes** for distributed, localized execution.
                </p>
            </div>

            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold text-slate-900 mb-6 text-center">Global Control Plane with Orchestrated Operational Nodes</h3>
                
                <!-- Architecture Diagram -->
                <div class="relative w-full p-4 overflow-x-auto">
                    <div class="min-w-[700px]">
                        <!-- Control Plane -->
                        <div class="arch-diagram-component bg-slate-800 text-white p-4 rounded-xl shadow-md mb-8">
                            <h4 class="font-bold text-center text-lg">üåê Global Control Plane</h4>
                            <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div class="expandable-card bg-slate-700 text-white rounded-lg cursor-pointer">
                                    <div class="p-2 flex justify-between items-center">
                                        <p class="text-xs font-semibold">üìú Config as Code</p>
                                        <div class="chevron text-slate-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                        </div>
                                    </div>
                                    <div class="expandable-card-content">
                                        <div class="px-2 pb-2 text-xs text-white leading-tight border-t border-slate-600 pt-1">
                                            Git-based repository for all configurations (IaC, rules) ensuring versioned, auditable changes.
                                        </div>
                                    </div>
                                </div>
                                <div class="expandable-card bg-slate-700 text-white rounded-lg cursor-pointer">
                                    <div class="p-2 flex justify-between items-center">
                                        <p class="text-xs font-semibold">ü§ñ Model Registry</p>
                                        <div class="chevron text-slate-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                        </div>
                                    </div>
                                    <div class="expandable-card-content">
                                        <div class="px-2 pb-2 text-xs text-white leading-tight border-t border-slate-600 pt-1">
                                            Centralized registry for deploying and versioning ML/AI decision models.
                                        </div>
                                    </div>
                                </div>
                                <div class="expandable-card bg-slate-700 text-white rounded-lg cursor-pointer">
                                    <div class="p-2 flex justify-between items-center">
                                        <p class="text-xs font-semibold">üìä Observability Stack</p>
                                        <div class="chevron text-slate-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                        </div>
                                    </div>
                                    <div class="expandable-card-content">
                                        <div class="px-2 pb-2 text-xs text-white leading-tight border-t border-slate-600 pt-1">
                                            Aggregates logs, metrics, and traces from all nodes for a unified system view.
                                        </div>
                                    </div>
                                </div>
                                <div class="expandable-card bg-slate-700 text-white rounded-lg cursor-pointer">
                                    <div class="p-2 flex justify-between items-center">
                                        <p class="text-xs font-semibold">üìù Rule Management</p>
                                        <div class="chevron text-slate-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                        </div>
                                    </div>
                                    <div class="expandable-card-content">
                                        <div class="px-2 pb-2 text-xs text-white leading-tight border-t border-slate-600 pt-1">
                                            Global UI for business users to define, test, and schedule rule deployments.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Connectors from Control Plane to Regional Nodes -->
                        <div class="connector vertical arrow-down" style="top: 130px; left: 50%; height: 40px;"></div>
                        <div class="connector horizontal" style="top: 170px; left: 25%; width: 50%;"></div>
                        <div class="connector vertical arrow-down" style="top: 170px; left: 25%; height: 30px;"></div>
                        <div class="connector vertical arrow-down" style="top: 170px; left: 75%; height: 30px;"></div>
                        <p class="absolute text-xs text-slate-500" style="top: 155px; left: 51%;">Control/Config Pushdown (gRPC, GitOps)</p>
                        
                        <!-- Regional Operational Nodes -->
                        <div class="flex justify-around mt-16 space-x-4">
                            <!-- Node 1: AMER -->
                            <div class="flex-1 arch-diagram-component">
                                <div class="bg-cyan-100 border-2 border-cyan-500 p-4 rounded-xl shadow-md">
                                    <h5 class="font-bold text-center text-cyan-800">üìç Regional Node (AMER)</h5>
                                    <div class="mt-4 space-y-2 text-xs text-cyan-900">
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üì• Ingestion Gateway</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Ingests events from local sources (web, mobile). Uses the Gateway Pattern for normalization.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üå™Ô∏è Event Stream</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Regional Kafka/Pulsar cluster for event streaming and buffering.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">‚öôÔ∏è Stream Processor</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Flink/Spark jobs for real-time data enrichment and processing.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üí° Decision Engine</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Local AI/ML models execute decisions based on regional data.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üóÑÔ∏è Polyglot Storage</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Polyglot persistence: Redis (cache), DocumentDB (profiles), GraphDB (relationships).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Node 2: EMEA -->
                             <div class="flex-1 arch-diagram-component">
                                <div class="bg-cyan-100 border-2 border-cyan-500 p-4 rounded-xl shadow-md">
                                    <h5 class="font-bold text-center text-cyan-800">üìç Regional Node (EMEA)</h5>
                                     <div class="mt-4 space-y-2 text-xs text-cyan-900">
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üì• Ingestion Gateway</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Ingests events from local sources (web, mobile). Uses the Gateway Pattern for normalization.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üå™Ô∏è Event Stream</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Regional Kafka/Pulsar cluster for event streaming and buffering.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">‚öôÔ∏è Stream Processor</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Flink/Spark jobs for real-time data enrichment and processing.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üí° Decision Engine</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Local AI/ML models execute decisions based on regional data.
                                                </div>
                                            </div>
                                        </div>
                                        <div class="expandable-card bg-cyan-200 text-cyan-900 rounded-md cursor-pointer">
                                            <div class="p-2 flex justify-between items-center">
                                                <p class="font-semibold">üóÑÔ∏è Polyglot Storage</p>
                                                <div class="chevron text-slate-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                                </div>
                                            </div>
                                            <div class="expandable-card-content">
                                                <div class="px-2 pb-2 text-xs text-cyan-900 leading-tight border-t border-cyan-300 pt-1">
                                                    Polyglot persistence: Redis (cache), DocumentDB (profiles), GraphDB (relationships).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Edge Tier -->
                        <div class="connector vertical" style="top: 500px; left: 25%; height: 30px;"></div>
                         <div class="connector vertical arrow-down" style="top: 500px; left: 75%; height: 30px;"></div>
                         <p class="absolute text-xs text-slate-500" style="top: 505px; left: 76%;">Edge Sync (MQTT, HTTP)</p>

                        <div class="flex justify-around mt-16 space-x-4">
                             <div class="flex-1 text-center">
                                <div class="expandable-card bg-slate-200 text-slate-800 rounded-lg shadow-sm cursor-pointer inline-block">
                                    <div class="p-3 flex justify-between items-center">
                                        <p class="text-xs font-semibold">üè™ Edge Node (Store)</p>
                                        <div class="chevron text-slate-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                        </div>
                                    </div>
                                    <div class="expandable-card-content">
                                        <div class="px-2 pb-2 text-xs text-slate-800 leading-tight border-t border-slate-300 pt-1">
                                            e.g., Retail Store POS, Bank Branch Terminal. Performs ultra-low latency, localized decisioning.
                                        </div>
                                    </div>
                                </div>
                             </div>
                              <div class="flex-1 text-center">
                                <div class="expandable-card bg-slate-200 text-slate-800 rounded-lg shadow-sm cursor-pointer inline-block">
                                    <div class="p-3 flex justify-between items-center">
                                        <p class="text-xs font-semibold">üì± Edge Node (Mobile)</p>
                                        <div class="chevron text-slate-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                        </div>
                                    </div>
                                    <div class="expandable-card-content">
                                        <div class="px-2 pb-2 text-xs text-slate-800 leading-tight border-t border-slate-300 pt-1">
                                            Customer's mobile device running the app. Can cache offers and perform minor logic.
                                        </div>
                                    </div>
                                </div>
                             </div>
                        </div>

                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6 text-slate-600">
                    <div>
                        <h4 class="font-bold text-slate-800 mb-2">Architectural Principles</h4>
                        <ul class="list-disc list-inside space-y-2 text-sm">
                            <li><strong>Global Governance, Local Autonomy:</strong> The control plane enforces global policies, deploys rules, and monitors health, but does not handle customer data. Operational nodes run autonomously within their region, ensuring data sovereignty and low-latency processing.</li>
                            <li><strong>Configuration as Code (GitOps):</strong> All configurations, rules, and infrastructure definitions are stored in a version-controlled repository. Changes are deployed automatically, providing a complete audit trail and enabling rapid, reliable rollbacks.</li>
                            <li><strong>Federated & Edge Decisioning:</strong> Drawing from IoT patterns, decisioning is pushed as close to the customer as possible. Regional nodes handle most real-time decisions, while edge nodes (e.g., in-store systems) can handle ultra-time-sensitive actions, operating even with intermittent connectivity.</li>
                             <li><strong>Zero-Trust Security:</strong> Communication between all components (plane-to-node, node-to-node, node-to-edge) is secured via mTLS, with access policies strictly enforced.</li>
                        </ul>
                    </div>
                     <div>
                        <h4 class="font-bold text-slate-800 mb-2">Data & Control Flow</h4>
                        <ul class="list-disc list-inside space-y-2 text-sm">
                            <li><strong>Control Flow (Top-Down):</strong> The control plane pushes configuration, rule updates, and model deployments down to the regional nodes. This is a low-bandwidth, highly-auditable process.</li>
                             <li><strong>Observability Flow (Bottom-Up):</strong> All nodes continuously stream metrics, logs, and traces back to the central observability stack in the control plane, providing a global view of system health and performance.</li>
                            <li><strong>Data Flow (Localized):</strong> Customer interaction data is ingested and processed entirely within a regional node. It does not flow to the control plane. Cross-region data synchronization is minimized and used only for essential global state (e.g., a customer's primary profile location).</li>
                            <li><strong>Federated Learning:</strong> AI models can be trained locally within each regional node on anonymized data. Only the learned model updates (weights, parameters) are sent back to the global Model Registry, not the raw customer data, respecting privacy and data sovereignty.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
            <p>Interactive Report generated from "Customer Decisioning Platforms vs IoT Implementations" Research.</p>
            <p>&copy; 2025 Architectural Insights Inc.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DATA STORE ---
            const techStackData = {
                labels: ['Event Streaming', 'Real-time Processing', 'Databases', 'Rule Engines', 'Protocols', 'Observability'],
                cdp: {
                    label: 'CDP', data: [5, 5, 4, 4, 3, 4],
                    borderColor: 'rgba(8, 145, 178, 1)',
                    backgroundColor: 'rgba(8, 145, 178, 0.2)',
                },
                iot: {
                    label: 'IoT', data: [5, 4, 4, 3, 5, 4],
                    borderColor: 'rgba(100, 116, 139, 1)',
                    backgroundColor: 'rgba(100, 116, 139, 0.2)',
                }
            };
            const protocolData = {
                labels: ['REST', 'gRPC', 'WebSocket', 'AMQP', 'MQTT', 'CoAP'],
                datasets: [
                    { label: 'Latency Profile', data: [3, 1, 1, 2, 1, 1], backgroundColor: 'rgba(22, 163, 74, 0.6)' },
                    { label: 'Overhead', data: [3, 1, 1, 2, 1, 1], backgroundColor: 'rgba(234, 179, 8, 0.6)' },
                    { label: 'Real-time Suitability', data: [2, 5, 5, 4, 5, 3], backgroundColor: 'rgba(37, 99, 235, 0.6)' }
                ]
            };
            const cardData = {
                operations: [
                    { icon: 'üöÄ', title: 'Horizontal Scaling', summary: 'Increasing capacity by adding more nodes to a resource pool.', details: 'Both CDPs and IoT systems use horizontal scaling via load balancers, container orchestration (like Kubernetes), and microservices to handle increasing workloads. This allows services to be decoupled and scaled independently.' },
                    { icon: '‚ö°Ô∏è', title: 'Performance Optimization', summary: 'Techniques to achieve low-latency decision-making and high throughput.', details: 'Key techniques include in-memory caching (Redis), edge computing to reduce network distance, parallel and asynchronous processing to use resources efficiently, and GPU acceleration for complex AI models.' },
                    { icon: 'üõ°Ô∏è', title: 'Fault Tolerance', summary: 'Ensuring operations continue even when components fail.', details: 'Mechanisms include redundancy, data replication across locations, automatic failover to standby systems, and state checkpointing (like in Apache Flink) to resume processing after a failure.' },
                    { icon: 'üö¶', title: 'Backpressure Handling', summary: 'Managing situations where a system receives more data than it can process.', details: 'Strategies include controlling the data producer, buffering excess data in bounded queues, and asynchronous processing. This prevents system overload, data loss, and crashes under high load.' },
                    { icon: 'üîÑ', title: 'Circuit Breakers & Retry Logic', summary: 'Patterns for managing service failures and facilitating recovery.', details: 'The Retry pattern re-attempts failed operations, while the Circuit Breaker pattern prevents an application from repeatedly calling a service that is likely to fail, thus avoiding cascading failures.' },
                    { icon: 'üëÅÔ∏è', title: 'Observability', summary: 'Gaining insight into system health and behavior through metrics, logs, and traces.', details: 'Observability is a prerequisite for proactive resilience. Distributed tracing is especially crucial for microservices-based CDPs to understand end-to-end request flows and pinpoint bottlenecks.' }
                ],
                topologies: [
                     { icon: 'üèûÔ∏è', title: 'Edge Processing', summary: 'Processing data closer to its source rather than in a centralized cloud.', details: 'A foundational pattern for real-time, localized decisioning. For CDPs, this means enabling immediate actions like in-store offers without cloud round-trips, reducing latency and optimizing bandwidth.' },
                     { icon: 'üåê', title: 'Federation Patterns', summary: 'Enabling distributed decision-making across multiple nodes or regions.', details: 'Federated Learning (FL) allows AI models to be trained locally on distributed datasets without centralizing raw data, respecting privacy and data sovereignty laws. Crucial for global CDPs.' },
                     { icon: 'üè¢', title: 'Hybrid Architectures', summary: 'Combining centralized cloud services with private infrastructure and edge computing.', details: 'Allows organizations to strategically allocate workloads for optimal performance, cost, and compliance. Latency-sensitive or regulated data can remain on-premises or at the edge.' }
                ],
                management: [
                    { icon: '‚öôÔ∏è', title: 'Dynamic Configuration', summary: 'Enabling systems to adapt to changing conditions without restarts.', details: 'Mechanisms like Spring Cloud Config or hot reloading allow CDPs to adjust parameters, deploy new rules, or activate features without interrupting service. Crucial for real-time responsiveness.' },
                    { icon: '‚öñÔ∏è', title: 'Rule Engine Patterns', summary: 'Centralizing and managing business rules, separating them from core logic.', details: 'Modern platforms integrate AI models to produce dynamic, context-driven outcomes, empowering business users with more flexible and intelligent tools for dynamic rule management.' },
                    { icon: 'üó≥Ô∏è', title: 'Versioning & Rollback', summary: 'Managing changes to rules and deployments to provide a safety net.', details: 'Techniques like A/B testing and Blue/Green deployments are essential for risk-managed rule evolution. They allow for data-driven validation of changes and provide near-zero-downtime releases.' },
                     { icon: 'üìú', title: 'Compliance & Governance', summary: 'Adhering to regulations and ensuring data quality, security, and accessibility.', details: 'Data governance is the foundation for trust in retail and finance. It ensures high-quality data for AI models and safeguards customer privacy. Audit trails are crucial for accountability.' }
                ]
            };
            
            // --- CHART RENDERING ---
            const radarCtx = document.getElementById('techStackRadarChart')?.getContext('2d');
            if(radarCtx) {
                const techStackRadarChart = new Chart(radarCtx, {
                    type: 'radar',
                    data: { labels: techStackData.labels, datasets: [techStackData.cdp] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { r: { angleLines: { color: 'rgba(0, 0, 0, 0.1)' }, grid: { color: 'rgba(0, 0, 0, 0.1)' }, pointLabels: { font: { size: 12 } }, ticks: { backdropColor: 'rgba(255, 255, 255, 0.75)', stepSize: 1, max: 5, min: 0 } } }, plugins: { legend: { position: 'top' } } }
                });
                const cdpBtn = document.getElementById('cdpBtn');
                const iotBtn = document.getElementById('iotBtn');
                const bothBtn = document.getElementById('bothBtn');
                const buttons = [cdpBtn, iotBtn, bothBtn];
                function updateRadarChart(datasets) { techStackRadarChart.data.datasets = datasets; techStackRadarChart.update(); }
                function setActiveButton(activeBtn) {
                     buttons.forEach(btn => {
                        btn.classList.remove('bg-cyan-500', 'text-white');
                        btn.classList.add('bg-slate-200', 'text-slate-700');
                    });
                    activeBtn.classList.add('bg-cyan-500', 'text-white');
                    activeBtn.classList.remove('bg-slate-200', 'text-slate-700');
                }
                cdpBtn.addEventListener('click', () => { updateRadarChart([techStackData.cdp]); setActiveButton(cdpBtn); });
                iotBtn.addEventListener('click', () => { updateRadarChart([techStackData.iot]); setActiveButton(iotBtn); });
                bothBtn.addEventListener('click', () => { updateRadarChart([techStackData.cdp, techStackData.iot]); setActiveButton(bothBtn); });
                setActiveButton(cdpBtn);
            }

            const barCtx = document.getElementById('protocolBarChart')?.getContext('2d');
            if(barCtx) {
                new Chart(barCtx, {
                    type: 'bar', data: protocolData,
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { callback: (val) => ['','VL','L','M','H','VH'][val] } }, x: { ticks: { autoSkip: false, maxRotation: 0 } } }, plugins: { legend: { position: 'top' }, tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${['','Very Low','Low','Medium','High','Very High'][ctx.parsed.y]}` } } } }
                });
            }

            // --- UI LOGIC ---
            function createCard(item) {
                return `
                    <div class="expandable-card bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer">
                        <div class="p-6 flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="text-3xl mr-4">${item.icon}</div>
                                <div>
                                    <h4 class="font-bold text-slate-900">${item.title}</h4>
                                    <p class="text-sm text-slate-500">${item.summary}</p>
                                </div>
                            </div>
                            <div class="chevron text-slate-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                            </div>
                        </div>
                        <div class="expandable-card-content"><div class="px-6 pb-6 text-slate-600 text-sm leading-relaxed border-t border-slate-100 pt-4">${item.details}</div></div>
                    </div>`;
            }

            document.getElementById('operational-cards-container').innerHTML = cardData.operations.map(createCard).join('');
            document.getElementById('topologies-cards-container').innerHTML = cardData.topologies.map(createCard).join('');
            document.getElementById('management-cards-container').innerHTML = cardData.management.map(createCard).join('');
            
            // Add event listeners to all expandable cards, including the new ones in the architecture diagram
            document.querySelectorAll('.expandable-card').forEach(card => card.addEventListener('click', () => card.classList.toggle('open')));

            // Navigation Logic
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main > section');
            const mobileNav = document.getElementById('mobile-nav');

            mobileNav.addEventListener('change', (e) => {
                const targetId = e.target.value;
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href').substring(1) === id);
                        });
                        if (document.activeElement !== mobileNav) {
                           mobileNav.value = `#${id}`;
                        }
                    }
                });
            }, { rootMargin: "-40% 0px -60% 0px", threshold: 0 });

            sections.forEach(section => observer.observe(section));
        });
    </script>

</body>
</html>
